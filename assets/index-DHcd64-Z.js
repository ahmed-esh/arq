(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(e){if(e.ep)return;e.ep=!0;const s=r(e);fetch(e.href,s)}})();console.log("AR Hit Test component registered");AFRAME.components["ar-hit-test"]||AFRAME.registerComponent("ar-hit-test",{schema:{target:{type:"selector"}},init:function(){this.xrHitTestSource=null,this.viewerSpace=null,this.refSpace=null,this.el.sceneEl.renderer.xr.addEventListener("sessionstart",()=>this.sessionStart()),this.el.sceneEl.renderer.xr.addEventListener("sessionend",()=>this.sessionEnd()),this.placed=!1,this.placeButton=document.getElementById("place-button"),this.reticle=document.getElementById("reticle"),this.placeButton&&this.placeButton.addEventListener("click",()=>this.placeFurniture())},sessionStart:async function(){const i=this.el.sceneEl.renderer.xr.getSession();this.viewerSpace=await i.requestReferenceSpace("viewer"),this.refSpace=await i.requestReferenceSpace("local-floor"),this.xrHitTestSource=await i.requestHitTestSource({space:this.viewerSpace})},sessionEnd:function(){this.xrHitTestSource&&(this.xrHitTestSource.cancel(),this.xrHitTestSource=null)},tick:function(){this.el.sceneEl.is("ar-mode")&&!this.placed&&this.detectSurface()},detectSurface:function(){const i=this.el.sceneEl.frame;if(!i)return;const t=i.getViewerPose(this.refSpace);if(this.xrHitTestSource&&t){const r=i.getHitTestResults(this.xrHitTestSource);if(r.length>0){const e=r[0].getPose(this.refSpace);this.reticle.setAttribute("visible","true"),this.reticle.setAttribute("position",{x:e.transform.position.x,y:e.transform.position.y,z:e.transform.position.z}),this.placeButton.style.display="block"}}},placeFurniture:function(){if(this.placed)return;console.log("Placing furniture...");const i=this.reticle.getAttribute("position");console.log("Reticle position:",i);const t=document.createElement("a-entity");t.setAttribute("gltf-model","#chair-model"),t.setAttribute("position",i),t.setAttribute("scale","0.1 0.1 0.1"),t.setAttribute("class","clickable"),t.setAttribute("draggable",""),t.setAttribute("shadow","cast: true"),t.addEventListener("model-loaded",()=>{console.log("Model loaded successfully")}),t.addEventListener("model-error",r=>{console.error("Error loading model:",r)}),this.el.sceneEl.appendChild(t),this.reticle.setAttribute("visible","false"),this.placeButton.style.display="none",this.placed=!0,console.log("Furniture entity added to scene"),document.getElementById("instructions").textContent="Furniture placed! You can drag to move it."}});AFRAME.components.draggable||AFRAME.registerComponent("draggable",{init:function(){this.el.addEventListener("mousedown",this.onDragStart.bind(this)),this.el.addEventListener("mouseup",this.onDragEnd.bind(this)),this.el.addEventListener("mousemove",this.onDrag.bind(this)),this.isDragging=!1},onDragStart:function(){this.isDragging=!0},onDragEnd:function(){this.isDragging=!1},onDrag:function(i){if(!this.isDragging)return;const t=i.detail.intersection.point;this.el.setAttribute("position",t)}});
